## IO管理

### 一、IO管理概述

#### 1.1 I/O设备

- 按照使用特性分类
  - 人机交互累外部设备，如打印机、显示器等
  - 存储设备，如磁盘、光盘等
  - 网络通信设备，如网络接口等
- 按传输速率分类
  - 低速设备：键鼠
  - 中速设备：打印机、扫描仪等
  - 高速设备：磁带机、磁盘机等
- 按信息交换单位分类
  - 块设备：以数据块为存储单位
  - 字符设备：传输单位为字符，如交互式终端机等

#### 1.2 I/O控制方式

![os_io_control](/Users/zhiwei/Documents/WorkSpace/Studio/AndroidInterviewNotes/操作系统/assets/os_io_control.png)

- 程序直接控制方式：CPU和I/O设备串行工作，由用户程序直接控制主存或CPU和外设的信息传送。
- 中断驱动方式：允许I/O设备主动打断CPU的运行并请求服务。
- DMA方式（直接存储器存储）：用窃取或挪用总线控制权，在设备和主存之间开辟直接数据交换通道，成批交换数据，不必CPU干预。
- 通道控制方式：独立于CPU的专门负责输入输出的处理器，有自己的通道指令，指令有CPU启动，结束操作后想CPU发出中断信号。实现了CPU、通道和设备的并行操作，提高系统资源利用率。

#### 1.3 I/O子系统的层次结构

1. 用户层I/O软件：实现与用户交互的接口
2. 设备独立性软件：实现用户程序与设备驱动器的统一结构、设备命令、设备保护以及分配释放
3. 设备驱动程序：与硬件直接相关，负责具体实现系统对设备发出的操作指令
4. 中断处理程序：用于处理中断相关事项
5. 硬件设备：包括设备自身和电子部件（控制器）

### 二、I/O核心子系统

主要提供IO调度、缓冲与高速缓存、设备分配与回收、假脱机、设备保护和差错处理

通过IO调度改善系统整体性能，使进程间公平共享设备访问，减少IO完成所需的平均等待时间

- 高速缓存与缓冲区

  - 高速缓存在内存中分两种形式
    - 在内存中开辟独立的存储空间，大小固定
    - 把胃里用的内存空间作为一个缓冲池，供请求分页系统和磁盘IO共享

  - 缓冲区

    - 采用硬件缓冲器，成本高，较少用。
    - 采用内存缓冲区

    1. 单缓存、双缓存、循环缓存、缓冲池

![os_io_cache](/Users/zhiwei/Documents/WorkSpace/Studio/AndroidInterviewNotes/操作系统/assets/os_io_cache.jpg)

- 设备分配与回收

  充分发挥设备使用效率，避免进程死锁。设备分类：独占设备、共享、虚拟设备；

- IO调度
  - 安全分配：为进程分配设备后则进程阻塞，完成后唤醒
  - 非安全分配：系统分配设备后，进程可继续执行，也可发出新的IO请求。同一进程可使用多个IO设备。
- 假脱机技术：若设备被占用，先缓存数据，设备空闲后再传输到设备。

  