## 内存管理

### 一、内存管理概念

#### 1、内存管理的基本原理和要求

> 内存：可存放数据，程序执行前需要先放到内存中才能被CPU处理，以缓和CPU与硬盘之间的速度矛盾。
>
> 功能：
>
> 1. 内存空间的分配与回收
> 2. 地址转换
> 3. 内存空间的扩充
> 4. 存储保护

##### 1.1 程序的装入和链接

步骤：编译、链接、装入。

链接类型：静态链接、装入时动态链接、运行时动态链接

装入模式：绝对装入、可重定位装入、动态运行时装入。

#### 2、覆盖与交换

多道程序环境用来扩充内存的方法。

覆盖：将程序分为多个段，常用的段常驻内存，不常用的段按需调入内存。

交换：内存中某些段移出，把外存中具备运行的载入

#### 3、连续分配管理方式

一个程序分配一个连续的内存空间

> 1. 单一连续分配
> 2. 固定分区分配
> 3. 动态分区分配
>    - 首次适应算法
>    - 最佳适应算法
>    - 最坏适应算法
>    - 邻近适应算法

#### 4、非连续分配管理方式

将程序分散地装入不相邻的内存分区，根据分区大小是否固定，分为**分页存储管理**、**分段存储管理**。

**分页存储管理**根据运行时是否把作业的所有页面都载入内存才能运行，又分为**基本分页存储管理**、**请求分页存储管理**方式。

- 基本分页存储管理方式

  - 分页管理不会产生碎片
  - 将主存空间划分为大小相等且固定的块，快相对较小，作为主存的基本单位，进程以块为单位空间申请。

- 基本分段存储管理方式

  按照用户进程中的自然段话分逻辑空间

- 段页式管理方式

  - 作为的地址空间首先被分为若干逻辑段，每段有自己的段号
  - 每段分为若干个大小固定的页
  - 对内存空间的管理仍然和分页管理一样
  - 会产生碎片

分页和分段的区别

| 对比项目         | 分页                                 | 分段                                                         |
| ---------------- | ------------------------------------ | ------------------------------------------------------------ |
| 对编程者的透明性 | 透明                                 | 需要编程者显式划分每个段                                     |
| 地址空间的维度   | 一维地址空间                         | 二维                                                         |
| 大小是否可变     | 页的大小固定                         | 段的大小可动态改变                                           |
| 出现原因         | 用于实现虚拟内存，以获得更大地址空间 | 使程序和数据可以被划分为逻辑上独立的地址空间，有助于共享和保护 |

### 二、虚拟内存管理

#### 2.1 基本概念

传统存储管理方式的特章：一次性、驻留性

局部性原理：时间局部性、空间局部性

虚拟存储器的定义：基于局部性原理，程序的一部分装入内存，一部分留在外存，按需载入。

特征：多次性、对换性、虚拟性。

实现：请求分页、分段、段页式存储管理。三种方式。

请求分页管理方式：系统基于基本分页系统，支持虚拟存储器功能而增加请求调页和页面置换功能。

#### 2.2 页面置换算法

- 最佳置换OPT
- 先进先出页面置换FIFO
- 最近最久未使用置换LRU
- 时钟置换CLOCK

#### 2.3 页面分配策略

固定分配局部置换、可变分配全局置换、可变分配局部置换

抖动：刚出现的页面又要换入内存的现象。原因：**分配的物理页帧数不足**；置换算法不当

工作集：某段时间内，进程要访问的页面集合。